# 貪吃蛇遊戲功能規格

## 功能概述
- **功能名稱**: 貪吃蛇遊戲
- **版本**: 1.0.0
- **建立日期**: 2025-01-17
- **最後更新**: 2025-01-17

## 澄清事項

### Session 2025-01-17
- Q: 蛇身節點的唯一性與碰撞檢測方式 → A: 基於位置座標檢測碰撞（蛇頭與身體節點座標重疊）
- Q: 遊戲錯誤處理與恢復機制 → A: 簡單的錯誤處理（顯示錯誤訊息，提供重新開始選項）
- Q: 遊戲區域大小與座標系統 → A: 固定網格系統（例如 20x20 網格）
- Q: 分數計算與遊戲難度 → A: 簡單分數系統（每吃一個食物得 10 分）
- Q: 遊戲速度與難度調整 → A: 漸進加速（隨分數增加速度變快）

## 業務需求

### 使用者故事
```
作為 遊戲玩家
我希望 能夠玩一個簡單的貪吃蛇遊戲
以便 享受經典的遊戲體驗和挑戰

驗收標準:
- [ ] 蛇能夠在遊戲區域內移動
- [ ] 蛇能夠吃掉食物並變長
- [ ] 當蛇碰到自己身體時遊戲結束
- [ ] 遊戲提供重新開始的功能
- [ ] 遊戲顯示當前分數
```

### 業務規則
1. 遊戲是單人模式，不需要多玩家支援
2. 蛇的移動是連續的，不能停止
3. 每吃掉一個食物，蛇的身體會增加一個節點
4. 蛇碰到自己的身體會立即死亡
5. 遊戲結束後可以重新開始

## BDD 規格

### 功能描述
```gherkin
功能: 貪吃蛇遊戲
  作為 遊戲玩家
  我希望 控制一條蛇在遊戲區域內移動並吃食物
  以便 享受經典的遊戲體驗
```

### 測試場景

#### 場景 1: 蛇的基本移動
```gherkin
場景: 蛇在遊戲區域內移動
  假設 遊戲已經開始
  當 玩家按下方向鍵
  那麼 蛇應該朝指定方向移動
```

#### 場景 2: 蛇吃食物並成長
```gherkin
場景: 蛇吃食物後變長
  假設 蛇頭接觸到食物
  當 蛇移動到下一個位置
  那麼 食物消失，蛇的身體增加一個節點
  而且 在隨機位置生成新的食物
  而且 分數增加 10 分
```

#### 場景 3: 蛇碰撞自己身體
```gherkin
場景: 蛇碰到自己身體遊戲結束
  假設 蛇的身體有多個節點
  當 蛇頭移動到與自己身體重疊的位置
  那麼 遊戲立即結束
  而且 顯示遊戲結束畫面
  而且 顯示最終分數
```

#### 場景 4: 遊戲重新開始
```gherkin
場景: 遊戲結束後重新開始
  假設 遊戲已經結束
  當 玩家按下重新開始按鈕
  那麼 遊戲重置到初始狀態
  而且 蛇回到初始位置和長度
  而且 分數重置為零
  而且 生成新的食物
```

#### 場景 5: 蛇碰到邊界
```gherkin
場景: 蛇碰到遊戲區域邊界
  假設 蛇移動到遊戲區域邊界
  當 蛇頭接觸邊界
  那麼 遊戲結束
  而且 顯示遊戲結束畫面
```

## 技術規格

### 遊戲實體
```json
{
  "snake": {
    "head": {
      "x": "number",
      "y": "number"
    },
    "body": [
      {
        "x": "number",
        "y": "number"
      }
    ],
    "direction": "string"
  },
  "food": {
    "x": "number",
    "y": "number"
  },
  "game": {
    "score": "number",
    "isRunning": "boolean",
    "gameOver": "boolean"
  }
}
```

### 碰撞檢測規則
- 蛇頭與身體節點碰撞：當蛇頭的 (x,y) 座標與任何身體節點的 (x,y) 座標完全重疊時觸發
- 蛇頭與邊界碰撞：當蛇頭座標超出遊戲區域邊界時觸發
- 蛇頭與食物碰撞：當蛇頭座標與食物座標完全重疊時觸發

### 遊戲狀態
- **運行中**: 蛇正常移動，等待玩家輸入
- **暫停**: 遊戲暫停，蛇停止移動
- **結束**: 遊戲結束，顯示結果
- **重置**: 遊戲回到初始狀態
- **錯誤**: 發生錯誤，顯示錯誤訊息

### 錯誤處理
- 當發生系統錯誤時，顯示友善的錯誤訊息
- 提供重新開始遊戲的選項
- 記錄錯誤資訊供開發除錯使用
- 不進行自動恢復，由使用者決定是否重新開始

## 測試計畫

### 單元測試
- [ ] 蛇移動邏輯測試
- [ ] 食物生成邏輯測試
- [ ] 碰撞檢測測試
- [ ] 分數計算測試
- [ ] 遊戲狀態管理測試

### 整合測試
- [ ] 完整遊戲流程測試
- [ ] 使用者輸入處理測試
- [ ] 遊戲畫面渲染測試

### 端對端測試
- [ ] 完整遊戲體驗測試
- [ ] 遊戲結束和重新開始流程測試

## 效能需求

### 回應時間
- 遊戲畫面更新頻率: 60 FPS
- 使用者輸入回應時間: ≤ 16ms
- 碰撞檢測回應時間: ≤ 1ms

### 遊戲體驗
- 蛇的移動應該流暢無卡頓
- 食物生成應該即時
- 遊戲狀態切換應該即時

### 遊戲速度機制
- 初始速度: 每 200ms 移動一格
- 加速規則: 每吃 5 個食物，移動間隔減少 20ms
- 最小速度: 移動間隔不低於 50ms
- 速度變化應該平滑，避免突然的跳躍

## 使用者介面需求

### 遊戲畫面
- 遊戲區域應該清晰可見
- 蛇的身體應該有明顯的視覺區分
- 食物應該容易識別
- 分數應該清楚顯示

### 控制方式
- 支援鍵盤方向鍵控制
- 支援重新開始功能
- 支援暫停/繼續功能

## 可維護性需求

### 程式碼品質
- 程式碼覆蓋率: ≥ 80%
- 程式碼複雜度: ≤ 10
- 靜態分析: 無嚴重問題

### 文檔要求
- [ ] 遊戲邏輯文檔
- [ ] 使用者操作指南
- [ ] 開發者文檔

## 驗收標準

### 功能驗收
- [ ] 所有 BDD 場景通過
- [ ] 蛇能夠正常移動和成長
- [ ] 碰撞檢測準確無誤
- [ ] 遊戲結束和重新開始功能正常
- [ ] 分數計算正確

### 品質驗收
- [ ] 測試覆蓋率達標
- [ ] 程式碼品質檢查通過
- [ ] 遊戲體驗流暢
- [ ] 使用者介面友好

## 假設與限制

### 假設
- 遊戲在標準的桌面環境中運行
- 使用者熟悉基本的鍵盤操作
- 遊戲區域使用固定 20x20 網格系統
- 蛇和食物都佔據單一網格單元
- 食物生成位置隨機且不與蛇身重疊
- 座標系統從 (0,0) 到 (19,19)

### 限制
- 僅支援單人遊戲模式
- 不支援遊戲存檔功能
- 不支援多種難度等級
- 不支援音效和背景音樂

## 相關文件
- [遊戲設計文檔](./game-design.md)
- [技術架構文檔](./architecture.md)
- [測試報告](./test-report.md)
- [使用者手冊](./user-manual.md)
